{% extends 'base.html' %}
{% block head %}
  <!-- Local JS file added-->
  <script type="text/javascript" src="{{url_for('static', filename='scripts/admin-question-set.js')}}"></script>
{% endblock head%}

{% block main %}
  <div class="content-questionset">
    <h1 class="text-center my-4"><strong>{{question_set.name}}</strong></h1>
    <p class="text-center color-primary">Admin</p>
    <div class="mb-2" id="{{question_set.is_public_label}}">
      <div class="text-center" id="privacy-title"></div>
      <div class="text-center" id="privacy-text"></div>
    </div>
    <div class="text-right mb-4" id="date-created">
      {{question_set.date_created}}
    </div>

    <a class="btn btn-outline-secondary btn-lg mr-0" type="button" 
      data-toggle="tooltip" data-placement="top" title="Return to quiz listing"
      href="{{url_for('main.quizzes')}}">
      <i class="fas fa-arrow-circle-left m-auto"></i><span class="ml-2">Return</span>        
    </a>

    <div class="my-4" id="add-user">
      <div class="card w-100">
        <div class="card-body">
          <h2 class="text-center my-4">Add user to quiz</h2>
          <div class="alert alert-danger" id="alert-error" role="alert">
            There was an error, please try later again.
          </div>
          <div class="alert alert-success" id="alert-success" role="alert">
            User added successfully!
          </div>
          
          <div class="input-group mb-3">
            <label for="search-user" class="m-2">Search user</label>
            <input type="text" class="form-control" placeholder="Search user by email" id="input-search-user">
            <div class="input-group-append">
              <button class="btn btn-outline-success" type="button" onclick="searchUser()">Search</button>
              <button class="btn btn-outline-danger" type="button" onclick="hideUserForm()">Cancel</button>
            </div>
          </div>

          <div id="search-results">
            <ul class="list-group list-group-flush mx-4" id="user-search-list"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Quiz' users -->
    <div class="my-4" id="user-list-section">
      <div class="card w-100">
        <div class="card-body">
          <div class="row">
            <div class="col-sm-11">
              <h5 class="card-title">Users</h5>
            </div>
            <div class="col-sm-1">
              <button type="button" class="btn btn-outline-success" id="btn-user-form"
                data-toggle="tooltip" data-placement="top" title="Add user to quiz"
                onclick="displayUserForm()">
                <i class="fas fa-user-plus"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="card-body px-1">
          <ul class="list-group list-group-flush mx-4" id="user-list">
            {% for user in users %}
              <li class="list-group-item list-group-item-action list-group-item-light">
                <div class="row" >
                  <div class="col-sm-9">
                    {{loop.index}} - {{user.first_name}} {{user.last_name}}
                  </div>
                  <div class="col-sm-1">
                    <a type="button" class="btn btn-outline-success" id="btn-mark"
                      data-toggle="tooltip" data-placement="top" title="Go user's results"
                      href="{{url_for('result_question_set.result_question_set_get', set_id=question_set.id, uid=user.id )}}">
                      <i class="fas fa-medal"></i>
                    </a>
                  </div>
                  <div class="col-sm-1">
                    <button type="button" class="btn btn-outline-primary" id="btn-mark"
                      data-toggle="tooltip" data-placement="top" title="Mark user's quiz"
                      onclick="markUser({{user.id}})">
                      <i class="fas fa-marker"></i>
                    </button>
                  </div>
                  <div class="col-sm-1">
                    <button type="button" class="btn btn-outline-danger" id="btn-remove-user"
                      data-toggle="modal" data-target="#remove-user-quiz-modal"
                      onclick="selectUser({{user.id}})">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <button type="button" class="btn btn-outline-danger my-4" id="btn-remove-user"
      data-toggle="modal" data-target="#delete-quiz-modal">
      <i class="fas fa-trash-alt"></i>
      Delete quiz
    </button>
  </div>

  <div class="modal fade" id="delete-quiz-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delete Quiz</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this Quiz?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" onclick="deleteQuestionSet()">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="remove-user-quiz-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Remove user</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Removing this user will delete the user and all the answers related to this user.</p>
          <p>Are you sure you want to remove this user from the quiz?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" onclick="removeUser()">Delete</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}